<?php

/**
 * Contains class CurrencyAmountFormElementWebTestCase.
 */

/**
 * Tests the currency_amount form element.
 */
class CurrencyAmountFormElementWebTestCase extends DrupalWebTestCase {

  static function getInfo() {
    return array(
      'name' => 'Currency amount form element',
      'group' => 'Currency',
    );
  }

  function setUp(array $modules = array()) {
    parent::setUp($modules + array('currency_test'));
  }

  /**
   * Test validation.
   */
  function testValidation() {
    $path = 'currency_test-form-element-currency-amount/50.00/100';

    // Test valid values.
    $values =  array(
      'amount[amount]' => '50,95',
      'amount[currency_code]' => 'EUR',
    );
    $this->drupalPost($path, $values, t('Submit'));
    $this->assertUrl('user', array(), 'A valid value higher than an explicitely configured <em>#minimum_value</em> triggers form submission.');

    // Test illegal characters.
    $values =  array(
      'amount[amount]' => $this->randomName(2),
    );
    $this->drupalPost($path, $values, t('Submit'));
    $this->assertText(t('The amount can only consist of a minus sign, decimals and one decimal mark.'), 'Non-numeric characters that are no period, comma, or minus sign throw a validation error.');

    // Test multiple decimal marks.
    $values =  array(
      'amount[amount]' => '49,.95',
    );
    $this->drupalPost($path, $values, t('Submit'));
    $this->assertText(t('The amount can only have no or one decimal separator and it must be one of '), 'Multiple decimal marks throw a validation error.');

    // Test the minimum value.
    $values =  array(
      'amount[amount]' => '49.95',
    );
    $this->drupalPost($path, $values, t('Submit'));
    $this->assertText(t('The minimum amount is '), 'An amount below the minimum throws a validation error.');

    // Test the maximum value.
    $values =  array(
      'amount[amount]' => '49.95',
    );
    $this->drupalPost($path, $values, t('Submit'));
    $this->assertText(t('The minimum amount is '), 'An amount above the maximum throws a validation error.');
  }
}
